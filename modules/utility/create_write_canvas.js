export{create_write_canvas};import{getScroll}from"./utility.js";var create_write_canvas=function(param){var default_param={"width":100,"height":100,"stokewidth":null};this.param=$.extend({},default_param,param);if(this.param.stokewidth===null){this.param.stokewidth=Math.max(1,this.param.stokeCheckwidth/5);};this.draw_canvas=document.createElement("canvas");this.draw_canvas.setAttribute('width',this.param.width);this.draw_canvas.setAttribute('height',this.param.height);this.draw_ctx=this.draw_canvas.getContext('2d');this.draw_isIdle=true;this.draw_enable=false;this.draw_path=[];this.draw_path_onetime=[];this.draw_start_callback=null;this.draw_move_callback=null;this.draw_end_callback=null;var _self=this;var drawstart=function(event){_self.draw_path_onetime=[];if(_self.draw_start_callback!==null){_self.draw_start_callback();};_self.draw_ctx.beginPath();let scrollxy=getScroll();let x=event.pageX-_self.draw_canvas.getBoundingClientRect().left-scrollxy[0];let y=event.pageY-_self.draw_canvas.getBoundingClientRect().top-scrollxy[1];_self.draw_ctx.moveTo(x,y);_self.draw_path_onetime.push([x,y]);if(_self.draw_enable){_self.draw_isIdle=false;}};var drawmove=function(event){if(_self.draw_isIdle)return;let scrollxy=getScroll();let x=event.pageX-_self.draw_canvas.getBoundingClientRect().left-scrollxy[0];let y=event.pageY-_self.draw_canvas.getBoundingClientRect().top-scrollxy[1];_self.draw_ctx.lineTo(x,y);_self.draw_ctx.lineWidth=_self.param.stokewidth;_self.draw_ctx.stroke();_self.draw_path_onetime.push([x,y]);if(_self.draw_move_callback!==null){_self.draw_move_callback();}};var drawend=function(event){if(_self.draw_isIdle)return;drawmove(event,_self);_self.draw_isIdle=true;_self.draw_path.push(_self.draw_path_onetime);_self.draw_path_onetime=[];if(_self.draw_end_callback!==null){_self.draw_end_callback();}};this.draw_canvas.addEventListener('touchstart',function(event){drawstart(event.touches[0])},false);this.draw_canvas.addEventListener('touchmove',function(event){drawmove(event.touches[0]);event.preventDefault();},false);this.draw_canvas.addEventListener('touchend',function(event){drawend(event.changedTouches[0])},false);this.draw_canvas.addEventListener('mousedown',function(e){drawstart(e)},false);this.draw_canvas.addEventListener('mousemove',function(e){drawmove(e)},false);this.draw_canvas.addEventListener('mouseup',function(e){drawend(e);},false);this.draw_canvas.addEventListener('mouseout',function(e){drawend(e);},false);};create_write_canvas.prototype.clear=function(){this.draw_ctx.clearRect(0,0,this.draw_canvas.width,this.draw_canvas.height);this.draw_path=[];}
